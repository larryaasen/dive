# dive_app

A fully featured Dive application running on macOS.

App Title: `Dive Camera and Audio`
Bunlde identifier: `com.moonwink.divecamera`

## Running the app
Running a dive app only works by running from Xcode. First, run this from the command line:
```
flutter run lib/main.dart --no-sound-null-safety
```
You will see this output:
```
Error waiting for a debug connection: The log reader stopped unexpectedly, or never started.
Error launching application on macOS.
```
That means that the deubber was not able to connect.

Then, run the app from Xcode. It should work from there.

# Known Issues
When uploading the macOS app to App Store Connect and TestFlight, there was a verification
error relate to the virtual camera plugin. The file data/obs-mac-virtualcam.plugin was
removed from the obslib framework to ensure the upload would work.

## TODO
1. Created an app icon, instead of using the Flutter icon.
1. Setup the new app icon.
1. Change the app install name from DiveCamera.app to Dive Camera.app.
1. Publish the pod obslib in a public repository.
1. This needs to be replaced: `pod 'obslib', :path => '/Users/larry/Projects/obslib-framework'`,
with the publish pod version.

## How to create a new Dive app for macOS

1. $ flutter create dive_app --platforms=macos --template=skeleton
1. $ cd dive_app
1. $ flutter run
1. Add `dive_core` and `dive_ui` to your pubspec.yaml file.
1. $ dart pub get
1. $ flutter run
1. There should now be a Podfile generated by Flutter in the macos folder.
1. In the file macos/Podfile, in the target 'Runner' section, add the line: `pod 'obslib', :path => '/Users/larry/Projects/obslib-framework'`. Also, change the line: `platform :osx, '10.11'` to use `10.13`.
1. Open Xcode and load the Runner.xcworkspace file.
1. Select the Runner target, under the General tab. Change the Deployment Target to 10.13.
1. In section Signing & Capabilities, in the App Sandbox, check both Network boxes, 
Camera, Audio Input, USB, and in File Access set all to Read/Write.
1. In the Info section, add the Privacy keys for Desktop Folder, Camera, Microphone, Documents Folder,
and Downloads Folder, using the Value: `Used for video recording and streaming.`
1. In the Build Phases section, add a New Run Script Phase. Add this to the Shell:
```
# Copy the framework resources to a specific folder in the app Resources
cp -R ${TARGET_BUILD_DIR}/${FRAMEWORKS_FOLDER_PATH}/obslib.framework/Resources/data ${TARGET_BUILD_DIR}/${UNLOCALIZED_RESOURCES_FOLDER_PATH}
rm -fr ${TARGET_BUILD_DIR}/${UNLOCALIZED_RESOURCES_FOLDER_PATH}/data/obs-mac-virtualcam.plugin
rsync ${TARGET_BUILD_DIR}/${FRAMEWORKS_FOLDER_PATH}/obslib.framework/PlugIns/* ${TARGET_BUILD_DIR}/${PLUGINS_FOLDER_PATH}
```

Note: The folder obs-mac-virtualcam.plugin is in the wrong folder, data, and will
fail validation by Apple, so it has been removed for now.

1. $ flutter run --no-sound-null-safety
1. You will likely see this error:
```
Error waiting for a debug connection: The log reader stopped unexpectedly, or never started.
```
That means that after the app started, Flutter was not able to connect. You can still
run the app by running from Xcode.

1. Add to main.dart: `import 'package:dive/dive.dart';`

## Getting Started

This project is a starting point for a Flutter application that follows the
[simple app state management
tutorial](https://flutter.dev/docs/development/data-and-backend/state-mgmt/simple).

For help getting started with Flutter, view our
[online documentation](https://flutter.dev/docs), which offers tutorials,
samples, guidance on mobile development, and a full API reference.

## Assets

The `assets` directory houses images, fonts, and any other files you want to
include with your application.

The `assets/images` directory contains [resolution-aware
images](https://flutter.dev/docs/development/ui/assets-and-images#resolution-aware).

## Localization

This project generates localized messages based on arb files found in
the `lib/src/localization` directory.

To support additional languages, please visit the tutorial on
[Internationalizing Flutter
apps](https://flutter.dev/docs/development/accessibility-and-localization/internationalization)
